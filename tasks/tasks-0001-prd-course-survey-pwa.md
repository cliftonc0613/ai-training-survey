# Task List: Course Survey PWA Implementation

Generated from: `0001-prd-course-survey-pwa.md`

---

## Relevant Files

### Core Configuration
- `package.json` - Project dependencies and scripts
- `next.config.mjs` - Next.js configuration with PWA setup
- `.env.local` - Environment variables for Supabase
- `tsconfig.json` - TypeScript configuration
- `public/manifest.json` - PWA manifest configuration
- `public/icon-192.png` - PWA icon (192x192)
- `public/icon-512.png` - PWA icon (512x512)

### Type Definitions
- `lib/types.ts` - TypeScript interfaces for Quiz, Question, User, Response types
- `lib/types/database.ts` - Supabase database types

### Utilities & Clients
- `lib/supabaseClient.ts` - Supabase client configuration
- `lib/utils/validation.ts` - Form validation utilities
- `lib/utils/storage.ts` - LocalStorage and IndexedDB helpers
- `lib/utils/resume-token.ts` - Resume token generation utilities

### Context & State Management
- `lib/context/UserContext.tsx` - User session context provider
- `lib/context/QuizContext.tsx` - Quiz state and progress context
- `lib/hooks/useOfflineQueue.ts` - Custom hook for offline queue management
- `lib/hooks/useQuizProgress.ts` - Custom hook for quiz progress tracking

### API Routes
- `app/api/user/route.ts` - User creation endpoint (POST)
- `app/api/quiz/route.ts` - Quiz submission endpoint (POST)
- `app/api/quiz/[slug]/route.ts` - Load quiz definition (GET)
- `app/api/resume/route.ts` - Generate resume token (POST)
- `app/api/resume/[token]/route.ts` - Load saved progress (GET)
- `app/api/admin/responses/route.ts` - Fetch all quiz responses (GET)
- `app/api/admin/users/route.ts` - Fetch user list (GET)

### Core Pages
- `app/page.tsx` - Landing page with "Start Survey" CTA
- `app/start/page.tsx` - User information form with validation
- `app/quizzes/page.tsx` - Quiz selection grid (4 cards)
- `app/quiz/[slug]/page.tsx` - Dynamic quiz page with question renderer
- `app/quiz/[slug]/resume/[token]/page.tsx` - Resume incomplete quiz
- `app/thank-you/page.tsx` - Completion confirmation page
- `app/admin/page.tsx` - Admin dashboard home
- `app/admin/responses/page.tsx` - View all responses with filters
- `app/admin/analytics/page.tsx` - Data visualization and analytics

### Components - UI Elements
- `components/QuizCard.tsx` - Quiz selection card with icon, title, description
- `components/ProgressBar.tsx` - Progress indicator with percentage
- `components/QuizNavigation.tsx` - Next/Previous/Save/Submit buttons
- `components/OfflineIndicator.tsx` - Offline status banner
- `components/QuizRenderer.tsx` - Main quiz question renderer

### Components - Question Types
- `components/QuestionTypes/MultipleChoice.tsx` - Radio buttons (cards or list style)
- `components/QuestionTypes/Checkbox.tsx` - Multi-select checkboxes
- `components/QuestionTypes/RatingScale.tsx` - Star/number/slider rating
- `components/QuestionTypes/Dropdown.tsx` - Select dropdown (searchable for 20+ items)
- `components/QuestionTypes/Slider.tsx` - Range slider with marks
- `components/QuestionTypes/TextShort.tsx` - Single-line text input
- `components/QuestionTypes/TextLong.tsx` - Multi-line textarea with character count

### Components - Admin Dashboard
- `components/Admin/Sidebar.tsx` - Admin navigation sidebar
- `components/Admin/ResponsesTable.tsx` - Data table for viewing responses
- `components/Admin/ResponseFilters.tsx` - Filter by quiz, date, user
- `components/Admin/ExportButton.tsx` - Export responses to CSV
- `components/Admin/AnalyticsChart.tsx` - Chart components using Recharts
- `components/Admin/UserStats.tsx` - User completion statistics

### Quiz Data
- `data/quizzes/survey-30days.json` - 30-day follow-up survey
- `data/quizzes/survey-90days.json` - 90-day follow-up survey
- `data/quizzes/survey-180days.json` - 180-day follow-up survey
- `data/quizzes/survey-12months-final.json` - 12-month final survey

### Service Worker & PWA
- `public/sw.js` - Service worker (generated by next-pwa)
- `public/workbox-*.js` - Workbox runtime (generated by next-pwa)

### Database Migrations
- `supabase/migrations/001_create_users_table.sql` - Users table schema
- `supabase/migrations/002_create_quiz_responses_table.sql` - Quiz responses table schema
- `supabase/migrations/003_enable_rls.sql` - Row Level Security policies

### Tests
- `__tests__/components/QuizCard.test.tsx` - QuizCard component tests
- `__tests__/components/QuestionTypes/MultipleChoice.test.tsx` - MultipleChoice tests
- `__tests__/api/user.test.ts` - User API endpoint tests
- `__tests__/api/quiz.test.ts` - Quiz submission API tests
- `__tests__/utils/validation.test.ts` - Validation utility tests
- `__tests__/e2e/quiz-flow.spec.ts` - E2E test for complete quiz flow

### Notes
- Tests should be placed in `__tests__/` directory mirroring the source structure
- Use `pnpm test` to run Jest tests
- Use `pnpm test:e2e` for end-to-end tests (Playwright)
- Database migrations should be applied via Supabase CLI or dashboard

---

## Tasks

- [ ] **1.0 Project Setup & Configuration**
  - [x] 1.1 Clone Mantine Next.js template repository
  - [x] 1.2 Review template structure and dependencies
  - [x] 1.3 Install dependencies using yarn
  - [x] 1.4 Run development server to verify setup
  - [x] 1.5 Install additional dependencies (@supabase/supabase-js, next-pwa)
  - [ ] 1.6 Configure environment variables (.env.local with Supabase credentials)
  - [ ] 1.5 Update package.json metadata (name, description)
  - [ ] 1.6 Configure TypeScript (tsconfig.json) with strict mode
  - [ ] 1.7 Set up ESLint and Prettier configuration
  - [ ] 1.8 Configure Mantine theme with custom colors (#46597e, #F06418)
  - [ ] 1.9 Create project directory structure (lib/, components/, data/)
  - [ ] 1.10 Initialize Git repository and create .gitignore

- [ ] **2.0 Core Infrastructure & Type Definitions**
  - [ ] 2.1 Create TypeScript interfaces in lib/types.ts (Quiz, Question, User, QuizResponse)
  - [ ] 2.2 Create database type definitions in lib/types/database.ts
  - [ ] 2.3 Set up Supabase client in lib/supabaseClient.ts
  - [ ] 2.4 Create validation utilities in lib/utils/validation.ts (name, email, phone validators)
  - [ ] 2.5 Create storage utilities in lib/utils/storage.ts (localStorage, IndexedDB helpers)
  - [ ] 2.6 Create resume token generator in lib/utils/resume-token.ts
  - [ ] 2.7 Set up UserContext in lib/context/UserContext.tsx for session management
  - [ ] 2.8 Set up QuizContext in lib/context/QuizContext.tsx for quiz state
  - [ ] 2.9 Create useOfflineQueue hook in lib/hooks/useOfflineQueue.ts
  - [ ] 2.10 Create useQuizProgress hook in lib/hooks/useQuizProgress.ts

- [ ] **3.0 Database Setup & API Routes**
  - [ ] 3.1 Create users table migration (supabase/migrations/001_create_users_table.sql)
  - [ ] 3.2 Create quiz_responses table migration (supabase/migrations/002_create_quiz_responses_table.sql)
  - [ ] 3.3 Configure Row Level Security policies (supabase/migrations/003_enable_rls.sql)
  - [ ] 3.4 Apply migrations to Supabase project
  - [ ] 3.5 Create POST /api/user route for user creation
  - [ ] 3.6 Create POST /api/quiz route for quiz submission
  - [ ] 3.7 Create GET /api/quiz/[slug] route for loading quiz definitions
  - [ ] 3.8 Create POST /api/resume route for generating resume tokens
  - [ ] 3.9 Create GET /api/resume/[token] route for loading saved progress
  - [ ] 3.10 Create GET /api/admin/responses route for fetching all responses
  - [ ] 3.11 Create GET /api/admin/users route for fetching user list
  - [ ] 3.12 Add error handling and validation to all API routes

- [ ] **4.0 User Interface - Core Pages**
  - [ ] 4.1 Create landing page (app/page.tsx) with hero section and "Start Survey" button
  - [ ] 4.2 Create user info form page (app/start/page.tsx) with Mantine Form
  - [ ] 4.3 Add real-time validation to user info form (name, email, phone)
  - [ ] 4.4 Implement redirect query parameter handling in /start page
  - [ ] 4.5 Create quiz selection page (app/quizzes/page.tsx) with responsive grid
  - [ ] 4.6 Create QuizCard component with icon, title, description, hover states
  - [ ] 4.7 Create dynamic quiz page (app/quiz/[slug]/page.tsx)
  - [ ] 4.8 Add session detection and redirect logic to quiz pages
  - [ ] 4.9 Create resume page (app/quiz/[slug]/resume/[token]/page.tsx)
  - [ ] 4.10 Create thank you page (app/thank-you/page.tsx) with navigation options
  - [ ] 4.11 Add mobile-responsive layouts for all pages
  - [ ] 4.12 Implement loading states for all page transitions

- [ ] **5.0 Question Type Components Library**
  - [ ] 5.1 Create MultipleChoice component (components/QuestionTypes/MultipleChoice.tsx)
  - [ ] 5.2 Add card-based style variant to MultipleChoice
  - [ ] 5.3 Add vertical radio-list style variant to MultipleChoice
  - [ ] 5.4 Create Checkbox component (components/QuestionTypes/Checkbox.tsx) with multi-select
  - [ ] 5.5 Create RatingScale component (components/QuestionTypes/RatingScale.tsx)
  - [ ] 5.6 Add star rating variant to RatingScale
  - [ ] 5.7 Add number buttons variant to RatingScale
  - [ ] 5.8 Add slider variant to RatingScale
  - [ ] 5.9 Create Dropdown component (components/QuestionTypes/Dropdown.tsx) with Mantine Select
  - [ ] 5.10 Add searchable functionality for dropdowns with 20+ items
  - [ ] 5.11 Create Slider component (components/QuestionTypes/Slider.tsx) with Mantine Slider
  - [ ] 5.12 Add visual marks and value display to Slider
  - [ ] 5.13 Create TextShort component (components/QuestionTypes/TextShort.tsx)
  - [ ] 5.14 Create TextLong component (components/QuestionTypes/TextLong.tsx) with character count
  - [ ] 5.15 Add validation props to all question components (required, min/max length)
  - [ ] 5.16 Ensure all components have proper accessibility (ARIA labels, keyboard nav)

- [ ] **6.0 Quiz Engine & State Management**
  - [ ] 6.1 Create QuizRenderer component to dynamically load question types
  - [ ] 6.2 Implement question navigation state (currentQuestion, answers)
  - [ ] 6.3 Create ProgressBar component with percentage and question counter
  - [ ] 6.4 Create QuizNavigation component (Previous, Next, Save, Submit buttons)
  - [ ] 6.5 Implement "Next" button disable logic (until question answered)
  - [ ] 6.6 Implement "Previous" button enable logic (except first question)
  - [ ] 6.7 Add "Save & Continue Later" functionality with localStorage
  - [ ] 6.8 Implement auto-save every 30 seconds
  - [ ] 6.9 Generate and store resume tokens
  - [ ] 6.10 Load and validate quiz JSON from /data/quizzes/ directory
  - [ ] 6.11 Add quiz validation (check for required fields, valid structure)
  - [ ] 6.12 Handle quiz submission to API endpoint
  - [ ] 6.13 Link user_id to quiz responses
  - [ ] 6.14 Show success/error notifications after submission

- [ ] **7.0 PWA Configuration & Offline Support**
  - [ ] 7.1 Configure next-pwa in next.config.mjs
  - [ ] 7.2 Create public/manifest.json with app metadata
  - [ ] 7.3 Generate PWA icons (192x192, 512x512) and add to /public
  - [ ] 7.4 Set theme color (#46597e) and background color (#ffffff)
  - [ ] 7.5 Configure service worker caching strategies
  - [ ] 7.6 Implement IndexedDB queue for offline submissions
  - [ ] 7.7 Create OfflineIndicator component for connection status
  - [ ] 7.8 Implement background sync when connection restored
  - [ ] 7.9 Add sync success/failure notifications
  - [ ] 7.10 Test PWA installability on iOS, Android, desktop
  - [ ] 7.11 Validate with Lighthouse PWA audit (score >90)

- [ ] **8.0 Admin Dashboard & Data Visualization**
  - [ ] 8.1 Create admin home page (app/admin/page.tsx) with overview stats
  - [ ] 8.2 Create admin layout with Sidebar component (components/Admin/Sidebar.tsx)
  - [ ] 8.3 Create responses page (app/admin/responses/page.tsx)
  - [ ] 8.4 Create ResponsesTable component with sortable columns
  - [ ] 8.5 Add ResponseFilters component (filter by quiz, date range, user)
  - [ ] 8.6 Implement pagination for responses table
  - [ ] 8.7 Create ExportButton component for CSV export
  - [ ] 8.8 Add CSV download functionality using Papa Parse or similar
  - [ ] 8.9 Create analytics page (app/admin/analytics/page.tsx)
  - [ ] 8.10 Install Recharts or Chart.js for visualizations
  - [ ] 8.11 Create AnalyticsChart component for response trends
  - [ ] 8.12 Create UserStats component showing completion rates
  - [ ] 8.13 Add quiz completion metrics (total, completed, abandoned)
  - [ ] 8.14 Implement basic authentication/access control for admin routes
  - [ ] 8.15 Style admin dashboard with premium Mantine components (DataTable, Charts)
  - [ ] 8.16 Add responsive design for admin dashboard (desktop-first)

- [ ] **9.0 Testing & Quality Assurance**
  - [ ] 9.1 Set up Jest and React Testing Library
  - [ ] 9.2 Write unit tests for validation utilities (__tests__/utils/validation.test.ts)
  - [ ] 9.3 Write tests for QuizCard component (__tests__/components/QuizCard.test.tsx)
  - [ ] 9.4 Write tests for MultipleChoice component
  - [ ] 9.5 Write tests for user API endpoint (__tests__/api/user.test.ts)
  - [ ] 9.6 Write tests for quiz API endpoint (__tests__/api/quiz.test.ts)
  - [ ] 9.7 Set up Playwright for E2E testing
  - [ ] 9.8 Write E2E test for standard quiz flow (__tests__/e2e/quiz-flow.spec.ts)
  - [ ] 9.9 Write E2E test for direct quiz link flow
  - [ ] 9.10 Write E2E test for save & resume functionality
  - [ ] 9.11 Test offline functionality (airplane mode simulation)
  - [ ] 9.12 Cross-browser testing (Chrome, Firefox, Safari, Edge)
  - [ ] 9.13 Mobile device testing (iOS Safari, Chrome Android)
  - [ ] 9.14 Accessibility testing with axe DevTools
  - [ ] 9.15 Performance testing with Lighthouse (target: <3s load time)
  - [ ] 9.16 Fix all identified bugs and issues

- [ ] **10.0 Deployment & Production Setup**
  - [ ] 10.1 Create Vercel account and connect GitHub repository
  - [ ] 10.2 Configure environment variables in Vercel dashboard
  - [ ] 10.3 Deploy to Vercel production
  - [ ] 10.4 Verify Supabase connection from production
  - [ ] 10.5 Test all user flows in production environment
  - [ ] 10.6 Validate PWA installation on production URL
  - [ ] 10.7 Run final Lighthouse audit on production (PWA score >90)
  - [ ] 10.8 Set up custom domain (optional)
  - [ ] 10.9 Configure Vercel analytics and monitoring
  - [ ] 10.10 Create deployment documentation
  - [ ] 10.11 Create user guide for sending quiz links
  - [ ] 10.12 Create admin guide for viewing responses

---

## Quiz Data Files to Create

Create these four quiz JSON files in `data/quizzes/`:

1. **survey-30days.json** - 30-day follow-up survey after course completion
2. **survey-90days.json** - 90-day follow-up survey to track progress
3. **survey-180days.json** - 180-day follow-up survey for long-term assessment
4. **survey-12months-final.json** - 12-month final comprehensive survey

Each file should follow the Quiz JSON schema defined in the PRD Appendix A.

---

**Sub-tasks generated successfully!** You can now begin implementation by working through these tasks sequentially.
